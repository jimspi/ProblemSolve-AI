<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProblemSolve AI Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="auth.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0f0f0f;
            color: #ffffff;
            overflow-x: hidden;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 40px;
            padding: 10px 0;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: #cbd5e1;
            text-decoration: none;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(99, 102, 241, 0.1);
            color: #6366f1;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .user-profile {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            font-size: 14px;
        }

        .user-plan {
            font-size: 12px;
            color: #cbd5e1;
        }

        /* Main Content */
        .main-content {
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a2e 100%);
            overflow: auto;
        }

        .header {
            padding: 20px 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(10px);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 24px;
            font-weight: 700;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .content-area {
            padding: 30px;
        }

        /* Problem Input Interface */
        .problem-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #ffffff;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #ffffff;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: #ffffff;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .tags-input {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .tag {
            background: rgba(99, 102, 241, 0.2);
            color: #6366f1;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tag-remove {
            cursor: pointer;
            font-weight: bold;
        }

        .urgency-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .urgency-option {
            padding: 12px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .urgency-option.selected {
            border-color: #6366f1;
            background: rgba(99, 102, 241, 0.1);
        }

        .urgency-label {
            font-weight: 600;
            font-size: 12px;
        }

        .urgency-desc {
            font-size: 10px;
            color: #cbd5e1;
            margin-top: 4px;
        }

        /* AI Analysis Results */
        .analysis-results {
            display: none;
            margin-top: 30px;
        }

        .analysis-results.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .result-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            position: relative;
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 15px 15px 0 0;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
        }

        .analysis-item {
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border-left: 4px solid #6366f1;
        }

        .item-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #6366f1;
        }

        .item-content {
            color: #cbd5e1;
            line-height: 1.5;
        }

        /* Solutions Section */
        .solutions-section {
            margin-top: 30px;
        }

        .solution-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            position: relative;
        }

        .solution-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .solution-title {
            font-size: 18px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 5px;
        }

        .solution-priority {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .solution-priority.medium {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .solution-priority.low {
            background: linear-gradient(135deg, #6b7280, #4b5563);
        }

        .solution-metrics {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric {
            text-align: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .metric-value {
            font-size: 20px;
            font-weight: 700;
            color: #6366f1;
        }

        .metric-label {
            font-size: 12px;
            color: #cbd5e1;
            margin-top: 4px;
        }

        .solution-steps {
            margin-top: 20px;
        }

        .step {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .step-number {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .step-description {
            color: #cbd5e1;
            font-size: 14px;
            line-height: 1.4;
        }

        /* Loading Animation */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 15, 15, 0.9);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-content {
            text-align: center;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(99, 102, 241, 0.3);
            border-top: 4px solid #6366f1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .loading-subtitle {
            color: #cbd5e1;
            font-size: 14px;
        }

        /* Dashboard Overview */
        .dashboard-overview {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #cbd5e1;
            font-size: 14px;
        }

        .recent-problems {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
        }

        .problem-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .problem-item:last-child {
            border-bottom: none;
        }

        .problem-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .problem-date {
            color: #cbd5e1;
            font-size: 12px;
        }

        .problem-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-solved {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .status-progress {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }

        .status-pending {
            background: rgba(107, 114, 128, 0.2);
            color: #6b7280;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .dashboard {
                grid-template-columns: 260px 1fr;
            }
            
            .form-grid, .results-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: none;
            }
            
            .dashboard-overview {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .solution-metrics {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">ProblemSolve AI</div>
            
            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#" class="nav-link active" onclick="showSection('dashboard')">
                            <div class="nav-icon">üìä</div>
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('new-problem')">
                            <div class="nav-icon">‚ûï</div>
                            New Problem
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('solutions')">
                            <div class="nav-icon">üí°</div>
                            Solutions
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('analytics')">
                            <div class="nav-icon">üìà</div>
                            Analytics
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('team')">
                            <div class="nav-icon">üë•</div>
                            Team
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <div class="nav-icon">‚öôÔ∏è</div>
                            Settings
                        </a>
                    </li>
                </ul>
            </nav>
            
            <div class="user-profile">
                <div class="user-info">
                    <div class="user-avatar">JD</div>
                    <div class="user-details">
                        <div class="user-name">John Doe</div>
                        <div class="user-plan">Professional Plan</div>
                    </div>
                </div>
                <button onclick="handleLogout()" style="margin-top: 10px; padding: 8px 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: #cbd5e1; font-size: 12px; cursor: pointer; width: 100%;">Logout</button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-content">
                    <h1 class="page-title" id="pageTitle">Dashboard</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary">Export Data</button>
                        <button class="btn" onclick="showSection('new-problem')">
                            ‚ûï New Problem
                        </button>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Dashboard Overview -->
                <section id="dashboard-section">
                    <div class="dashboard-overview">
                        <div class="stat-card">
                            <div class="stat-value" id="problemsCount">0</div>
                            <div class="stat-label">Problems Solved</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="successRate">-</div>
                            <div class="stat-label">Success Rate</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="avgTime">-</div>
                            <div class="stat-label">Avg. Days to Solution</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="valueGenerated">$0</div>
                            <div class="stat-label">Value Generated</div>
                        </div>
                    </div>

                    <div class="recent-problems">
                        <h2 class="section-title">Recent Problems</h2>
                        <div id="problemsList">
                            <div style="text-align: center; padding: 60px 20px; color: #cbd5e1;">
                                <div style="font-size: 48px; margin-bottom: 20px; opacity: 0.3;">üöÄ</div>
                                <h3 style="font-size: 20px; margin-bottom: 10px; color: #ffffff;">Ready to solve your first problem?</h3>
                                <p style="margin-bottom: 30px;">Use our AI-powered analysis to break down complex challenges and get actionable solutions.</p>
                                <button class="btn" onclick="showSection('new-problem')">Analyze Your First Problem</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- New Problem Section -->
                <section id="new-problem-section" style="display: none;">
                    <div class="problem-input">
                        <h2 class="section-title">Describe Your Challenge</h2>
                        
                        <div class="form-grid">
                            <div>
                                <div class="form-group">
                                    <label class="form-label">Problem Title</label>
                                    <input type="text" class="form-input" id="problemTitle" placeholder="Give your problem a clear, descriptive title">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Problem Description</label>
                                    <textarea class="form-textarea" id="problemDescription" placeholder="Describe the challenge in detail. What's happening? When did it start? What's the impact?"></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Pain Points & Symptoms</label>
                                    <input type="text" class="form-input" id="painPointInput" placeholder="Add a pain point and press Enter">
                                    <div class="tags-input" id="painPointTags"></div>
                                </div>
                            </div>
                            
                            <div>
                                <div class="form-group">
                                    <label class="form-label">Desired Outcome</label>
                                    <textarea class="form-textarea" id="desiredOutcome" placeholder="What does success look like? What specific results do you want to achieve?"></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Constraints & Limitations</label>
                                    <textarea class="form-textarea" id="constraints" placeholder="Budget limits, time constraints, resource availability, regulatory requirements, etc."></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Urgency Level</label>
                                    <div class="urgency-selector">
                                        <div class="urgency-option" onclick="selectUrgency('low')">
                                            <div class="urgency-label">Low</div>
                                            <div class="urgency-desc">1+ months</div>
                                        </div>
                                        <div class="urgency-option" onclick="selectUrgency('medium')">
                                            <div class="urgency-label">Medium</div>
                                            <div class="urgency-desc">2-4 weeks</div>
                                        </div>
                                        <div class="urgency-option selected" onclick="selectUrgency('high')">
                                            <div class="urgency-label">High</div>
                                            <div class="urgency-desc">1-2 weeks</div>
                                        </div>
                                        <div class="urgency-option" onclick="selectUrgency('critical')">
                                            <div class="urgency-label">Critical</div>
                                            <div class="urgency-desc">< 1 week</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Additional Context & Variables</label>
                            <textarea class="form-textarea" id="additionalContext" placeholder="Team dynamics, previous attempts, stakeholder concerns, market conditions, etc."></textarea>
                        </div>
                        
                        <button class="btn" onclick="analyzeProblem()">
                            üß† Analyze Problem with AI
                        </button>
                    </div>

                    <!-- AI Analysis Results -->
                    <div class="analysis-results" id="analysisResults">
                        <h2 class="section-title">AI Analysis Results</h2>
                        
                        <div class="results-grid">
                            <div class="result-card">
                                <div class="card-header">
                                    <div class="card-icon">üéØ</div>
                                    <div class="card-title">Root Cause Analysis</div>
                                </div>
                                <div id="rootCauseContent">
                                    <!-- Populated by AI -->
                                </div>
                            </div>
                            
                            <div class="result-card">
                                <div class="card-header">
                                    <div class="card-icon">üìä</div>
                                    <div class="card-title">Impact Assessment</div>
                                </div>
                                <div id="impactContent">
                                    <!-- Populated by AI -->
                                </div>
                            </div>
                        </div>

                        <div class="solutions-section">
                            <h3 class="section-title">Recommended Solutions</h3>
                            <div id="solutionsContent">
                                <!-- Populated by AI -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Other sections would go here -->
                <section id="solutions-section" style="display: none;">
                    <h2 class="section-title">Solution Library</h2>
                    <p style="color: #cbd5e1;">Browse and manage all your AI-generated solutions...</p>
                </section>

                <section id="analytics-section" style="display: none;">
                    <h2 class="section-title">Analytics & Insights</h2>
                    <p style="color: #cbd5e1;">Track your problem-solving performance and trends...</p>
                </section>

                <section id="team-section" style="display: none;">
                    <h2 class="section-title">Team Collaboration</h2>
                    <p style="color: #cbd5e1;">Manage team members and collaborative problem-solving...</p>
                </section>
            </div>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">AI is analyzing your problem...</div>
            <div class="loading-subtitle">This may take 10-30 seconds</div>
        </div>
    </div>

    <script>
        let currentUrgency = 'high';
        let painPoints = [];

        // Navigation
        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('section').forEach(sec => sec.style.display = 'none');
            
            // Show target section
            document.getElementById(section + '-section').style.display = 'block';
            
            // Update navigation
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            event.target.closest('.nav-link').classList.add('active');
            
            // Update page title
            const titles = {
                'dashboard': 'Dashboard',
                'new-problem': 'New Problem Analysis',
                'solutions': 'Solution Library',
                'analytics': 'Analytics & Insights',
                'team': 'Team Collaboration'
            };
            document.getElementById('pageTitle').textContent = titles[section] || 'Dashboard';
        }

        // Urgency Selection
        function selectUrgency(urgency) {
            currentUrgency = urgency;
            document.querySelectorAll('.urgency-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.closest('.urgency-option').classList.add('selected');
        }

        // Pain Points Management
        document.getElementById('painPointInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && this.value.trim()) {
                addPainPoint(this.value.trim());
                this.value = '';
            }
        });

        function addPainPoint(text) {
            if (!painPoints.includes(text)) {
                painPoints.push(text);
                updatePainPointTags();
            }
        }

        function removePainPoint(text) {
            painPoints = painPoints.filter(point => point !== text);
            updatePainPointTags();
        }

        function updatePainPointTags() {
            const container = document.getElementById('painPointTags');
            container.innerHTML = painPoints.map(point => 
                `<div class="tag">
                    ${point}
                    <span class="tag-remove" onclick="removePainPoint('${point}')">√ó</span>
                </div>`
            ).join('');
        }

        // Main AI Analysis Function
        function analyzeProblem() {
            const problemData = {
                title: document.getElementById('problemTitle').value,
                description: document.getElementById('problemDescription').value,
                painPoints: painPoints,
                desiredOutcome: document.getElementById('desiredOutcome').value,
                constraints: document.getElementById('constraints').value,
                urgency: currentUrgency,
                additionalContext: document.getElementById('additionalContext').value
            };

            // Validation
            if (!problemData.title || !problemData.description || !problemData.desiredOutcome) {
                alert('Please fill in the required fields: Title, Description, and Desired Outcome');
                return;
            }

            // Show loading
            document.getElementById('loadingOverlay').style.display = 'flex';
            
            // Simulate AI processing time
            setTimeout(() => {
                generateAIAnalysis(problemData);
                document.getElementById('loadingOverlay').style.display = 'none';
                document.getElementById('analysisResults').classList.add('show');
                
                // Scroll to results
                document.getElementById('analysisResults').scrollIntoView({ behavior: 'smooth' });
            }, 3000);
        }

        // AI Analysis Generator
        function generateAIAnalysis(problemData) {
            // Generate root cause analysis
            const rootCauses = generateRootCauseAnalysis(problemData);
            document.getElementById('rootCauseContent').innerHTML = rootCauses;

            // Generate impact assessment
            const impact = generateImpactAssessment(problemData);
            document.getElementById('impactContent').innerHTML = impact;

            // Generate solutions
            const solutions = generateSolutions(problemData);
            document.getElementById('solutionsContent').innerHTML = solutions;
        }

        function generateRootCauseAnalysis(data) {
            const causes = [
                {
                    title: "Primary Root Cause",
                    content: getSmartRootCause(data.description, data.painPoints)
                },
                {
                    title: "Contributing Factors",
                    content: getContributingFactors(data.description, data.additionalContext)
                },
                {
                    title: "Systemic Issues",
                    content: getSystemicIssues(data.description, data.constraints)
                }
            ];

            return causes.map(cause => 
                `<div class="analysis-item">
                    <div class="item-title">${cause.title}</div>
                    <div class="item-content">${cause.content}</div>
                </div>`
            ).join('');
        }

        function generateImpactAssessment(data) {
            const impacts = [
                {
                    title: "Business Impact",
                    content: getBusinessImpact(data.description, data.desiredOutcome)
                },
                {
                    title: "Timeline Implications",
                    content: getTimelineImpact(data.urgency, data.description)
                },
                {
                    title: "Resource Requirements",
                    content: getResourceImpact(data.constraints, data.desiredOutcome)
                }
            ];

            return impacts.map(impact => 
                `<div class="analysis-item">
                    <div class="item-title">${impact.title}</div>
                    <div class="item-content">${impact.content}</div>
                </div>`
            ).join('');
        }

        function generateSolutions(data) {
            const solutions = getSmartSolutions(data);
            
            return solutions.map((solution, index) => 
                `<div class="solution-card">
                    <div class="solution-header">
                        <div>
                            <div class="solution-title">${solution.title}</div>
                        </div>
                        <div class="solution-priority ${solution.priority}">${solution.priority.toUpperCase()} PRIORITY</div>
                    </div>
                    
                    <div class="solution-metrics">
                        <div class="metric">
                            <div class="metric-value">${solution.successRate}%</div>
                            <div class="metric-label">Success Rate</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${solution.timeframe}</div>
                            <div class="metric-label">Timeframe</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${solution.effort}</div>
                            <div class="metric-label">Effort Level</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${solution.cost}</div>
                            <div class="metric-label">Cost Impact</div>
                        </div>
                    </div>
                    
                    <p style="color: #cbd5e1; margin-bottom: 20px;">${solution.description}</p>
                    
                    <div class="solution-steps">
                        <h4 style="margin-bottom: 15px; color: #ffffff;">Implementation Steps:</h4>
                        ${solution.steps.map((step, stepIndex) => 
                            `<div class="step">
                                <div class="step-number">${stepIndex + 1}</div>
                                <div class="step-content">
                                    <div class="step-title">${step.title}</div>
                                    <div class="step-description">${step.description}</div>
                                </div>
                            </div>`
                        ).join('')}
                    </div>
                </div>`
            ).join('');
        }

        // Smart AI Content Generation Functions
        function getSmartRootCause(description, painPoints) {
            if (description.toLowerCase().includes('customer') || description.toLowerCase().includes('churn')) {
                return "Analysis indicates the primary root cause is likely a mismatch between customer expectations and delivered value. This often manifests through poor onboarding experiences, inadequate customer success processes, or product-market fit issues.";
            } else if (description.toLowerCase().includes('team') || description.toLowerCase().includes('productivity')) {
                return "The core issue appears to be workflow inefficiencies and communication barriers within the team structure. This typically stems from unclear processes, inadequate tools, or misaligned objectives between team members.";
            } else if (description.toLowerCase().includes('revenue') || description.toLowerCase().includes('sales')) {
                return "Revenue decline indicators suggest fundamental issues in the sales funnel, pricing strategy, or market positioning. The root cause likely involves lead quality deterioration or competitive disadvantage.";
            } else {
                return "Based on the problem description, the primary root cause appears to be systemic process breakdowns that create cascading inefficiencies. This suggests a need for fundamental restructuring of core operational workflows.";
            }
        }

        function getContributingFactors(description, context) {
            const factors = [];
            if (context && context.toLowerCase().includes('team')) {
                factors.push("Team communication gaps");
                factors.push("Insufficient training or resources");
            }
            if (description.toLowerCase().includes('market') || description.toLowerCase().includes('competition')) {
                factors.push("Market condition changes");
                factors.push("Competitive pressure increase");
            }
            factors.push("Legacy system limitations");
            factors.push("Resource allocation inefficiencies");
            
            return factors.join(", ") + " are amplifying the core problem and must be addressed alongside the primary solution.";
        }

        function getSystemicIssues(description, constraints) {
            if (constraints && constraints.toLowerCase().includes('budget')) {
                return "Budget constraints are creating systemic underinvestment in critical areas, leading to technical debt accumulation and process degradation over time.";
            } else {
                return "Long-term systemic issues include inadequate feedback loops, insufficient data visibility, and decision-making bottlenecks that prevent rapid problem resolution.";
            }
        }

        function getBusinessImpact(description, outcome) {
            const impacts = [];
            if (description.toLowerCase().includes('revenue') || outcome.toLowerCase().includes('revenue')) {
                impacts.push("Direct revenue impact estimated at 15-25% if unresolved");
            }
            if (description.toLowerCase().includes('customer') || outcome.toLowerCase().includes('customer')) {
                impacts.push("Customer satisfaction scores likely to decline 20-30%");
            }
            impacts.push("Operational efficiency reduction of approximately 35%");
            impacts.push("Team morale and retention risks increasing");
            
            return impacts.join(". ") + ".";
        }

        function getTimelineImpact(urgency, description) {
            const timeframes = {
                'critical': "Immediate action required - delays will compound the problem exponentially within days",
                'high': "Solutions must be implemented within 2 weeks to prevent significant impact escalation",
                'medium': "4-week implementation window available before major consequences manifest",
                'low': "Flexible timeline allows for thorough solution planning over 8+ weeks"
            };
            return timeframes[urgency] || timeframes['medium'];
        }

        function getResourceImpact(constraints, outcome) {
            if (constraints && constraints.toLowerCase().includes('budget')) {
                return "Budget-conscious solutions prioritized. Estimated resource requirement: 40-60% of typical solution cost through strategic resource reallocation and phased implementation.";
            } else {
                return "Optimal resource allocation requires cross-functional team involvement with approximately 20-25 hours per week for 4-6 weeks, plus executive sponsorship for decision acceleration.";
            }
        }

        function getSmartSolutions(data) {
            const solutions = [];
            
            // Solution 1: Quick Win
            solutions.push({
                title: "Immediate Process Optimization",
                priority: "high",
                successRate: 85,
                timeframe: "1-2 weeks",
                effort: "Medium",
                cost: "Low",
                description: "Implement immediate process improvements and communication protocols to address the most critical pain points while building momentum for larger changes.",
                steps: [
                    {
                        title: "Rapid Assessment & Quick Wins",
                        description: "Conduct 48-hour assessment to identify immediate optimization opportunities and implement quick fixes that provide instant relief."
                    },
                    {
                        title: "Communication Protocol Implementation",
                        description: "Establish clear communication channels and daily check-in processes to ensure alignment and rapid issue resolution."
                    },
                    {
                        title: "Metrics & Monitoring Setup",
                        description: "Create real-time dashboards to track progress and identify emerging issues before they become problems."
                    }
                ]
            });

            // Solution 2: Comprehensive Approach
            solutions.push({
                title: "Strategic Restructuring Initiative",
                priority: "medium",
                successRate: 92,
                timeframe: "4-6 weeks",
                effort: "High",
                cost: "Medium",
                description: "Comprehensive solution addressing root causes through systematic process redesign, technology optimization, and team restructuring.",
                steps: [
                    {
                        title: "Root Cause Deep Dive",
                        description: "Conduct thorough analysis of all contributing factors using data analytics and stakeholder interviews."
                    },
                    {
                        title: "Process Redesign & Automation",
                        description: "Redesign core workflows with automation integration to eliminate bottlenecks and improve efficiency."
                    },
                    {
                        title: "Team Optimization & Training",
                        description: "Restructure team roles and provide targeted training to align skills with new processes."
                    },
                    {
                        title: "Technology Integration",
                        description: "Implement supporting technology solutions to enable the new processes and provide ongoing optimization."
                    }
                ]
            });

            // Solution 3: Innovation Approach
            solutions.push({
                title: "Innovative Technology Solution",
                priority: "low",
                successRate: 78,
                timeframe: "8-12 weeks",
                effort: "High",
                cost: "High",
                description: "Cutting-edge approach leveraging advanced technology and innovative methodologies to create a competitive advantage while solving the core problem.",
                steps: [
                    {
                        title: "Technology Research & Selection",
                        description: "Evaluate emerging technologies and select optimal solutions for long-term strategic advantage."
                    },
                    {
                        title: "Pilot Program Development",
                        description: "Create controlled pilot program to test innovative approaches and measure effectiveness."
                    },
                    {
                        title: "Full-Scale Implementation",
                        description: "Roll out proven solutions across the organization with comprehensive change management."
                    },
                    {
                        title: "Optimization & Scaling",
                        description: "Continuously optimize the solution and scale successful elements to other areas of the business."
                    }
                ]
            });

            return solutions;
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', async function() {
            // Protect the page - redirect if not authenticated
            const hasAccess = await window.supabaseAuth.protectPage();
            
            if (!hasAccess) {
                return; // User will be redirected to login
            }
            
            // Load user data
            const { data: { user } } = await window.supabaseAuth.getUser();
            if (user) {
                // Update user profile in sidebar
                const userAvatar = document.querySelector('.user-avatar');
                const userName = document.querySelector('.user-name');
                const userPlan = document.querySelector('.user-plan');
                
                if (userAvatar) {
                    userAvatar.textContent = (user.user_metadata?.full_name || user.email || 'U').charAt(0).toUpperCase();
                }
                if (userName) {
                    userName.textContent = user.user_metadata?.full_name || user.email;
                }
                if (userPlan) {
                    const savedPlan = JSON.parse(localStorage.getItem('userPlan') || '{}');
                    userPlan.textContent = savedPlan.planDetails?.name || 'Professional Plan';
                }
            }
            
            // Set up some sample pain points for demo
            painPoints = ['Declining customer satisfaction', 'Increased response times', 'Resource allocation issues'];
            updatePainPointTags();
            
            // Initialize empty dashboard for new users
            initializeDashboard();
        });

        function initializeDashboard() {
            // Check if user has any solved problems
            const solvedProblems = JSON.parse(localStorage.getItem('solvedProblems') || '[]');
            
            if (solvedProblems.length === 0) {
                // New user - show empty state
                updateDashboardStats(0, null, null, 0);
            } else {
                // Existing user - calculate and show real stats
                updateDashboardStats(
                    solvedProblems.length,
                    calculateSuccessRate(solvedProblems),
                    calculateAvgTime(solvedProblems),
                    calculateValueGenerated(solvedProblems)
                );
                displayRecentProblems(solvedProblems);
            }
        }

        function updateDashboardStats(problemsCount, successRate, avgTime, valueGenerated) {
            document.getElementById('problemsCount').textContent = problemsCount;
            document.getElementById('successRate').textContent = successRate ? successRate + '%' : '-';
            document.getElementById('avgTime').textContent = avgTime ? avgTime : '-';
            document.getElementById('valueGenerated').textContent = valueGenerated ? '
    </script>
</body>
</html> + valueGenerated : '$0';
        }

        function calculateSuccessRate(problems) {
            if (problems.length === 0) return null;
            const solved = problems.filter(p => p.status === 'solved').length;
            return Math.round((solved / problems.length) * 100);
        }

        function calculateAvgTime(problems) {
            if (problems.length === 0) return null;
            // Mock calculation - in real app would use actual dates
            return (Math.random() * 20 + 5).toFixed(1);
        }

        function calculateValueGenerated(problems) {
            if (problems.length === 0) return 0;
            // Mock calculation - in real app would track actual value
            return (problems.length * 50000).toLocaleString();
        }

        function displayRecentProblems(problems) {
            const container = document.getElementById('problemsList');
            if (problems.length === 0) return;

            container.innerHTML = problems.slice(-4).reverse().map(problem => 
                `<div class="problem-item">
                    <div>
                        <div class="problem-title">${problem.title}</div>
                        <div class="problem-date">Analyzed ${problem.date}</div>
                    </div>
                    <div class="problem-status status-${problem.status}">${problem.status.charAt(0).toUpperCase() + problem.status.slice(1)}</div>
                </div>`
            ).join('');
        }

        function saveProblemToHistory(problemData) {
            const solvedProblems = JSON.parse(localStorage.getItem('solvedProblems') || '[]');
            const newProblem = {
                title: problemData.title,
                date: new Date().toLocaleDateString(),
                status: 'solved',
                ...problemData
            };
            
            solvedProblems.push(newProblem);
            localStorage.setItem('solvedProblems', JSON.stringify(solvedProblems));
            
            // Update dashboard
            initializeDashboard();
        }
    </script>
</body>
</html>
